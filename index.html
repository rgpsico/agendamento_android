<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agenda Pro - Professor</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app" class="app-shell">
      <div v-if="!isAuthenticated" class="login-screen">
        <div class="login-card">
          <h1>Agenda Pro</h1>
          <p class="subtitle">Acesso do Professor</p>
          <label class="field">
            <span>Email</span>
            <input type="email" v-model.trim="loginForm.email" placeholder="prof@escola.com" />
          </label>
          <label class="field">
            <span>Senha</span>
            <input type="password" v-model="loginForm.password" placeholder="******" />
          </label>
          <button class="primary-btn" @click="handleLogin">Entrar</button>
          <button class="text-btn" @click="showForgot = !showForgot">Esqueci a senha</button>
          <p v-if="showForgot" class="hint">Funcionalidade em breve.</p>
          <p v-if="loginError" class="error">{{ loginError }}</p>
        </div>
      </div>

      <div v-else class="app-container">
        <header class="topbar">
          <div>
            <p class="label">Professor</p>
            <h2>{{ teacher.name }}</h2>
          </div>
          <button class="secondary-btn" @click="logout">Logout</button>
        </header>

        <main class="content">
          <section v-if="currentTab === 'dashboard'" class="view">
            <h3>Dashboard</h3>
            <div class="filter-row">
              <label class="field small">
                <span>Data Início</span>
                <input type="date" v-model="dashboardStart" />
              </label>
              <label class="field small">
                <span>Data Final</span>
                <input type="date" v-model="dashboardEnd" />
              </label>
              <button class="primary-btn" @click="applyDashboardFilter">Filtrar</button>
            </div>

            <div class="cards">
              <div class="card clickable" @click="openDaySchedule">
                <p class="card-title">Agendamentos do Dia</p>
                <p class="card-value">{{ dayAppointments.length }}</p>
                <p class="card-subtitle">{{ activeDayLabel }}</p>
              </div>
              <div class="card">
                <p class="card-title">Número de Agendamentos no Mês</p>
                <p class="card-value">{{ monthAppointments.length }}</p>
                <p class="card-subtitle">{{ activeMonthLabel }}</p>
              </div>
              <div class="card">
                <p class="card-title">Agendamentos por Período</p>
                <div class="mini-chart">
                  <div
                    v-for="item in groupedByDate"
                    :key="item.date"
                    class="chart-row"
                  >
                    <span>{{ item.label }}</span>
                    <div class="bar">
                      <span :style="{ width: item.count * 12 + 'px' }"></span>
                    </div>
                    <strong>{{ item.count }}</strong>
                  </div>
                  <p v-if="!groupedByDate.length" class="hint">Sem dados no período.</p>
                </div>
              </div>
            </div>
          </section>

          <section v-if="currentTab === 'daySchedule'" class="view">
            <div class="view-header">
              <h3>Agendamentos do Dia</h3>
              <button class="text-btn" @click="currentTab = 'dashboard'">Voltar</button>
            </div>
            <p class="subtitle">{{ activeDayLabel }}</p>
            <div v-if="dayAppointments.length" class="list">
              <div v-for="appt in dayAppointments" :key="appt.id" class="list-item">
                <div>
                  <strong>{{ appt.time }}</strong>
                  <p>{{ appt.studentName }} · {{ appt.serviceName }}</p>
                </div>
                <span class="status" :class="appt.status">{{ appt.status }}</span>
              </div>
            </div>
            <p v-else class="hint">Nenhum agendamento encontrado.</p>
          </section>

          <section v-if="currentTab === 'appointments'" class="view">
            <div class="view-header">
              <h3>Agendamentos</h3>
              <button class="primary-btn" @click="startNewAppointment">Novo</button>
            </div>
            <div class="filter-row">
              <label class="field small">
                <span>Data</span>
                <input type="date" v-model="appointmentsFilter.date" />
              </label>
              <label class="field small">
                <span>Status</span>
                <select v-model="appointmentsFilter.status">
                  <option value="">Todos</option>
                  <option value="confirmado">Confirmado</option>
                  <option value="pendente">Pendente</option>
                  <option value="cancelado">Cancelado</option>
                </select>
              </label>
            </div>
            <div class="list">
              <div v-for="appt in filteredAppointments" :key="appt.id" class="list-item">
                <div>
                  <strong>{{ appt.date }} · {{ appt.time }}</strong>
                  <p>{{ appt.studentName }} · {{ appt.serviceName }}</p>
                </div>
                <div class="actions">
                  <button class="text-btn" @click="editAppointment(appt)">Editar</button>
                  <button class="text-btn danger" @click="cancelAppointment(appt.id)">Cancelar</button>
                </div>
              </div>
              <p v-if="!filteredAppointments.length" class="hint">Nenhum agendamento encontrado.</p>
            </div>

            <div class="form-card">
              <h4>{{ appointmentForm.id ? 'Editar Agendamento' : 'Novo Agendamento' }}</h4>
              <div class="form-grid">
                <label class="field">
                  <span>Data</span>
                  <input type="date" v-model="appointmentForm.date" />
                </label>
                <label class="field">
                  <span>Hora</span>
                  <input type="time" v-model="appointmentForm.time" />
                </label>
                <label class="field">
                  <span>Aluno</span>
                  <select v-model="appointmentForm.studentId">
                    <option disabled value="">Selecione</option>
                    <option v-for="student in students" :key="student.id" :value="student.id">
                      {{ student.name }}
                    </option>
                  </select>
                </label>
                <label class="field">
                  <span>Servico</span>
                  <select v-model="appointmentForm.serviceId">
                    <option disabled value="">Selecione</option>
                    <option v-for="service in services" :key="service.id" :value="service.id">
                      {{ service.name }}
                    </option>
                  </select>
                </label>
                <label class="field">
                  <span>Status</span>
                  <select v-model="appointmentForm.status">
                    <option value="confirmado">Confirmado</option>
                    <option value="pendente">Pendente</option>
                    <option value="cancelado">Cancelado</option>
                  </select>
                </label>
              </div>
              <div class="actions">
                <button class="primary-btn" @click="saveAppointment">Salvar</button>
                <button class="text-btn" @click="resetAppointmentForm">Limpar</button>
              </div>
            </div>
          </section>

          <section v-if="currentTab === 'services'" class="view">
            <div class="view-header">
              <h3>Servicos</h3>
              <button class="primary-btn" @click="startNewService">Novo</button>
            </div>
            <div class="list">
              <div v-for="service in services" :key="service.id" class="list-item">
                <div>
                  <strong>{{ service.name }}</strong>
                  <p>{{ service.description }}</p>
                  <p>{{ service.duration }} min · R$ {{ service.price }}</p>
                </div>
                <div class="actions">
                  <button class="text-btn" @click="editService(service)">Editar</button>
                  <button class="text-btn danger" @click="removeService(service.id)">Remover</button>
                </div>
              </div>
            </div>

            <div class="form-card">
              <h4>{{ serviceForm.id ? 'Editar Servico' : 'Novo Servico' }}</h4>
              <div class="form-grid">
                <label class="field">
                  <span>Nome</span>
                  <input type="text" v-model.trim="serviceForm.name" />
                </label>
                <label class="field">
                  <span>Descricao</span>
                  <input type="text" v-model.trim="serviceForm.description" />
                </label>
                <label class="field">
                  <span>Duracao (min)</span>
                  <input type="number" v-model.number="serviceForm.duration" />
                </label>
                <label class="field">
                  <span>Preco (R$)</span>
                  <input type="number" v-model.number="serviceForm.price" />
                </label>
              </div>
              <div class="actions">
                <button class="primary-btn" @click="saveService">Salvar</button>
                <button class="text-btn" @click="resetServiceForm">Limpar</button>
              </div>
            </div>
          </section>

          <section v-if="currentTab === 'students'" class="view">
            <div class="view-header">
              <h3>Alunos</h3>
              <button class="primary-btn" @click="startNewStudent">Novo</button>
            </div>
            <div class="list">
              <div v-for="student in students" :key="student.id" class="list-item">
                <div>
                  <strong>{{ student.name }}</strong>
                  <p>{{ student.email }} · {{ student.phone }}</p>
                  <p>Historico: {{ student.history }}</p>
                </div>
                <div class="actions">
                  <button class="text-btn" @click="editStudent(student)">Editar</button>
                  <button class="text-btn danger" @click="removeStudent(student.id)">Remover</button>
                </div>
              </div>
            </div>

            <div class="form-card">
              <h4>{{ studentForm.id ? 'Editar Aluno' : 'Novo Aluno' }}</h4>
              <div class="form-grid">
                <label class="field">
                  <span>Nome</span>
                  <input type="text" v-model.trim="studentForm.name" />
                </label>
                <label class="field">
                  <span>Email</span>
                  <input type="email" v-model.trim="studentForm.email" />
                </label>
                <label class="field">
                  <span>Telefone</span>
                  <input type="text" v-model.trim="studentForm.phone" />
                </label>
                <label class="field">
                  <span>Historico</span>
                  <input type="text" v-model.trim="studentForm.history" />
                </label>
              </div>
              <div class="actions">
                <button class="primary-btn" @click="saveStudent">Salvar</button>
                <button class="text-btn" @click="resetStudentForm">Limpar</button>
              </div>
            </div>
          </section>

          <section v-if="currentTab === 'availability'" class="view">
            <div class="view-header">
              <h3>Horarios</h3>
              <button class="primary-btn" @click="startNewAvailability">Novo</button>
            </div>
            <div class="list">
              <div v-for="slot in availability" :key="slot.id" class="list-item">
                <div>
                  <strong>{{ slot.day }} · {{ slot.start }} - {{ slot.end }}</strong>
                  <p>{{ slot.status === 'livre' ? 'Disponivel' : 'Bloqueado' }}</p>
                </div>
                <div class="actions">
                  <button class="text-btn" @click="toggleAvailability(slot.id)">
                    {{ slot.status === 'livre' ? 'Bloquear' : 'Liberar' }}
                  </button>
                  <button class="text-btn danger" @click="removeAvailability(slot.id)">Remover</button>
                </div>
              </div>
            </div>

            <div class="form-card">
              <h4>Novo Horario</h4>
              <div class="form-grid">
                <label class="field">
                  <span>Dia</span>
                  <select v-model="availabilityForm.day">
                    <option disabled value="">Selecione</option>
                    <option v-for="day in weekDays" :key="day">{{ day }}</option>
                  </select>
                </label>
                <label class="field">
                  <span>Inicio</span>
                  <input type="time" v-model="availabilityForm.start" />
                </label>
                <label class="field">
                  <span>Fim</span>
                  <input type="time" v-model="availabilityForm.end" />
                </label>
              </div>
              <div class="actions">
                <button class="primary-btn" @click="saveAvailability">Salvar</button>
                <button class="text-btn" @click="resetAvailabilityForm">Limpar</button>
              </div>
            </div>
          </section>
        </main>

        <nav class="bottom-nav">
          <button :class="{ active: currentTab === 'dashboard' }" @click="currentTab = 'dashboard'">
            Dashboard
          </button>
          <button :class="{ active: currentTab === 'appointments' }" @click="currentTab = 'appointments'">
            Agendamentos
          </button>
          <button :class="{ active: currentTab === 'services' }" @click="currentTab = 'services'">
            Servicos
          </button>
          <button :class="{ active: currentTab === 'students' }" @click="currentTab = 'students'">
            Alunos
          </button>
          <button :class="{ active: currentTab === 'availability' }" @click="currentTab = 'availability'">
            Horarios
          </button>
        </nav>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <script src="app.js"></script>
  </body>
</html>
